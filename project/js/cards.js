        // å‹•ç‰©è³‡æ–™
        window.animals = [
            {
                id: 1,
                name: "ç…å­",
                emoji: "ğŸ¦",
                category: "savanna",
                habitat: "éæ´²è‰åŸ",
                fact: "ç…å­æ˜¯è‰åŸä¹‹ç‹ï¼Œé›„ç…çš„é¬ƒæ¯›è¶Šæ¿ƒå¯†ä»£è¡¨è¶Šå¼·å£¯ï¼",
                sound: "å¼å¼å¼ï¼",
                collected: false
            },
            {
                id: 2,
                name: "ç†Šè²“",
                emoji: "ğŸ¼",
                category: "forest",
                habitat: "ä¸­åœ‹ç«¹æ—",
                fact: "ç†Šè²“ä¸€å¤©è¦åƒ12-38å…¬æ–¤çš„ç«¹å­ï¼Œè¶…ç´šèƒ½åƒï¼",
                sound: "å—¯å—¯å—¯~",
                collected: false
            },
            {
                id: 3,
                name: "ä¼éµ",
                emoji: "ğŸ§",
                category: "ocean",
                habitat: "å—æ¥µåœ°å€",
                fact: "ä¼éµèµ°è·¯æ–æ–æ“ºæ“ºå¾ˆå¯æ„›ï¼Œä½†åœ¨æ°´ä¸­æ¸¸æ³³è¶…ç´šå¿«ï¼",
                sound: "å˜å˜å˜ï¼",
                collected: false
            },
            {
                id: 4,
                name: "å°ç‰›",
                emoji: "ğŸ„",
                category: "farm",
                habitat: "è¾²å ´ç‰§å ´",
                fact: "å°ç‰›æ¯å¤©å¯ä»¥ç”¢å‡ºå¾ˆå¤šæ–°é®®ç‰›å¥¶çµ¦å¤§å®¶å–ï¼",
                sound: "å“å“å“~",
                collected: false
            },
            {
                id: 5,
                name: "è€è™",
                emoji: "ğŸ…",
                category: "forest",
                habitat: "äºæ´²å¢æ—",
                fact: "è€è™çš„æ¢ç´‹å°±åƒäººé¡çš„æŒ‡ç´‹ä¸€æ¨£ï¼Œæ¯éš»éƒ½ä¸åŒï¼",
                sound: "å—·å—šå—·å—šï¼",
                collected: false
            },
            {
                id: 6,
                name: "æµ·è±š",
                emoji: "ğŸ¬",
                category: "ocean",
                habitat: "æµ·æ´‹",
                fact: "æµ·è±šå¾ˆè°æ˜ï¼Œæœƒç”¨è²éŸ³å’ŒåŒä¼´æºé€šï¼",
                sound: "å’¿å’¿å’¿~",
                collected: false
            },
            {
                id: 7,
                name: "å°è±¬",
                emoji: "ğŸ·",
                category: "farm",
                habitat: "è¾²å ´",
                fact: "å°è±¬å…¶å¯¦å¾ˆæ„›ä¹¾æ·¨ï¼Œåªæ˜¯å–œæ­¡åœ¨æ³¥å·´è£¡é™æº«ï¼",
                sound: "å“¼å“¼å“¼~",
                collected: false
            },
            {
                id: 8,
                name: "é•·é ¸é¹¿",
                emoji: "ğŸ¦’",
                category: "savanna",
                habitat: "éæ´²è‰åŸ",
                fact: "é•·é ¸é¹¿çš„èˆŒé ­æœ‰50å…¬åˆ†é•·ï¼Œå¯ä»¥åƒåˆ°é«˜é«˜çš„æ¨¹è‘‰ï¼",
                sound: "å—¯å—¯~",
                collected: false
            },
            {
                id: 9,
                name: "ç‹ç‹¸",
                emoji: "ğŸ¦Š",
                category: "forest",
                habitat: "æ£®æ—",
                fact: "ç‹ç‹¸å¾ˆè°æ˜ï¼Œæœƒç”¨å„ç¨®ç­–ç•¥ä¾†å°‹æ‰¾é£Ÿç‰©ï¼",
                sound: "å—·å—·å—·~",
                collected: false
            },
            {
                id: 10,
                name: "é¯¨é­š",
                emoji: "ğŸ³",
                category: "ocean",
                habitat: "æ·±æµ·",
                fact: "è—é¯¨æ˜¯åœ°çƒä¸Šæœ€å¤§çš„å‹•ç‰©ï¼Œå¿ƒè‡Ÿå°±åƒä¸€è¼›å°æ±½è»Šé‚£éº¼å¤§ï¼",
                sound: "å—šå—šå—š~",
                collected: false
            },
            {
                id: 11,
                name: "å°ç¾Š",
                emoji: "ğŸ‘",
                category: "farm",
                habitat: "è¾²å ´è‰åœ°",
                fact: "å°ç¾Šçš„æ¯›æ¯›å¾ˆæº«æš–ï¼Œå¯ä»¥åšæˆæ¯›è¡£ä¿æš–ï¼",
                sound: "å’©å’©å’©~",
                collected: false
            },
            {
                id: 12,
                name: "å¤§è±¡",
                emoji: "ğŸ˜",
                category: "savanna",
                habitat: "éæ´²è‰åŸ",
                fact: "å¤§è±¡ç”¨é¼»å­å°±åƒæˆ‘å€‘ç”¨æ‰‹ä¸€æ¨£ï¼Œå¯ä»¥æ‹¿æ±è¥¿å’Œæ‰“æ‹›å‘¼ï¼",
                sound: "å—šå—šå—šï¼",
                collected: false
            },
            {
                id: 13,
                name: "å…”å­",
                emoji: "ğŸ°",
                category: "forest",
                habitat: "æ£®æ—è‰åœ°",
                fact: "å…”å­çš„è€³æœµå¾ˆéˆæ•ï¼Œå¯ä»¥è½åˆ°å¾ˆé çš„è²éŸ³ï¼",
                sound: "å—¯å—¯å—¯~",
                collected: false
            },
            {
                id: 14,
                name: "ç« é­š",
                emoji: "ğŸ™",
                category: "ocean",
                habitat: "æµ·åº•",
                fact: "ç« é­šæœ‰8éš»è§¸æ‰‹å’Œ3é¡†å¿ƒè‡Ÿï¼Œè¶…ç´šç‰¹åˆ¥ï¼",
                sound: "å’•åš•å’•åš•~",
                collected: false
            },
            {
                id: 15,
                name: "å°é›",
                emoji: "ğŸ¤",
                category: "farm",
                habitat: "è¾²å ´",
                fact: "å°é›å‰›å‡ºç”Ÿå°±æœƒèµ°è·¯ï¼ŒçœŸçš„å¾ˆå²å®³ï¼",
                sound: "å•¾å•¾å•¾~",
                collected: false
            },
            {
                id: 16,
                name: "æ²³é¦¬",
                emoji: "ğŸ¦›",
                category: "savanna",
                habitat: "éæ´²æ²³æµ",
                fact: "æ²³é¦¬çœ‹èµ·ä¾†ç¬¨é‡ï¼Œä½†æ¸¸æ³³é€Ÿåº¦å¾ˆå¿«ï¼",
                sound: "å“¼å“¼å“¼ï¼",
                collected: false
            },
            {
                id: 17,
                name: "çŒ´å­",
                emoji: "ğŸµ",
                category: "forest",
                habitat: "ç†±å¸¶æ£®æ—",
                fact: "çŒ´å­å¾ˆæœƒçˆ¬æ¨¹ï¼Œå¯ä»¥åœ¨æ¨¹æé–“å¿«é€Ÿè·³èºï¼",
                sound: "å±å±å±~",
                collected: false
            },
            {
                id: 18,
                name: "èƒèŸ¹",
                emoji: "ğŸ¦€",
                category: "ocean",
                habitat: "æµ·é‚Šæ²™ç˜",
                fact: "èƒèŸ¹æ©«è‘—èµ°è·¯ï¼Œé‰—å­å¾ˆæœ‰åŠ›æ°£ï¼",
                sound: "å¡å¡å¡~",
                collected: false
            },
            {
                id: 19,
                name: "é´¨å­",
                emoji: "ğŸ¦†",
                category: "farm",
                habitat: "è¾²å ´æ± å¡˜",
                fact: "é´¨å­çš„è…³æœ‰è¹¼ï¼Œæ¸¸æ³³å¾ˆå²å®³ï¼",
                sound: "å˜å˜å˜~",
                collected: false
            },
            {
                id: 20,
                name: "æ–‘é¦¬",
                emoji: "ğŸ¦“",
                category: "savanna",
                habitat: "éæ´²è‰åŸ",
                fact: "æ–‘é¦¬çš„æ¢ç´‹å¯ä»¥è¿·æƒ‘æ•µäººï¼Œæ˜¯å¤©ç„¶çš„ä¿è­·è‰²ï¼",
                sound: "å˜¶å˜¶å˜¶~",
                collected: false
            },
            {
                id: 21,
                name: "æ¾é¼ ",
                emoji: "ğŸ¿ï¸",
                category: "forest",
                habitat: "æ£®æ—æ¨¹ä¸Š",
                fact: "æ¾é¼ æœƒæŠŠå …æœè—èµ·ä¾†ç•¶å†¬å¤©çš„é£Ÿç‰©ï¼",
                sound: "å±å±å±~",
                collected: false
            },
            {
                id: 22,
                name: "æµ·é¾œ",
                emoji: "ğŸ¢",
                category: "ocean",
                habitat: "æµ·æ´‹",
                fact: "æµ·é¾œå¯ä»¥æ´»å¾ˆä¹…å¾ˆä¹…ï¼Œæœ‰äº›è¶…é100æ­²ï¼",
                sound: "å—¯å—¯å—¯~",
                collected: false
            },
            {
                id: 23,
                name: "é¦¬",
                emoji: "ğŸ´",
                category: "farm",
                habitat: "è¾²å ´è‰åœ°",
                fact: "é¦¬è·‘å¾—å¾ˆå¿«ï¼Œå¤æ™‚å€™æ˜¯é‡è¦çš„äº¤é€šå·¥å…·ï¼",
                sound: "å¸Œå¾‹å¾‹~",
                collected: false
            },
            {
                id: 24,
                name: "çŠ€ç‰›",
                emoji: "ğŸ¦",
                category: "savanna",
                habitat: "éæ´²è‰åŸ",
                fact: "çŠ€ç‰›çš„è§’å¾ˆç¡¬ï¼Œæ˜¯ç”¨ä¾†ä¿è­·è‡ªå·±çš„ï¼",
                sound: "å“¼å“¼å“¼ï¼",
                collected: false
            }
        ];

        let currentFilter = 'all';
        let currentSearch = '';

        // å‹•ç‰©æ”¶é›†ç³»çµ±
        class AnimalCollectionSystem {
            constructor() {
                this.loadCollectedAnimals();
                this.loadGameCollectedAnimals();
            }
            
            // è¼‰å…¥å·²æ”¶é›†çš„å‹•ç‰©
            loadCollectedAnimals() {
                const saved = localStorage.getItem('collectedAnimals');
                if (saved) {
                    const collectedIds = JSON.parse(saved);
                    window.animals.forEach(animal => {
                        animal.collected = collectedIds.includes(animal.id);
                    });
                }
            }
            
            // è¼‰å…¥éŠæˆ²ç²å¾—çš„å‹•ç‰©
            loadGameCollectedAnimals() {
                const saved = localStorage.getItem('gameCollectedAnimals');
                if (saved) {
                    const gameAnimals = JSON.parse(saved);
                    let nextId = Math.max(...window.animals.map(a => a.id)) + 1;
                    
                    gameAnimals.forEach(gameAnimal => {
                        // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒåç¨±çš„å‹•ç‰©
                        const existingAnimal = window.animals.find(a => a.name === gameAnimal.name);
                        if (existingAnimal) {
                            existingAnimal.collected = true;
                        } else {
                            // æ·»åŠ æ–°å‹•ç‰©
                            gameAnimal.id = nextId++;
                            window.animals.push(gameAnimal);
                        }
                    });
                }
            }
            
            // ä¿å­˜æ”¶é›†é€²åº¦
            saveCollectedAnimals() {
                const collectedIds = window.animals.filter(a => a.collected).map(a => a.id);
                localStorage.setItem('collectedAnimals', JSON.stringify(collectedIds));
            }
            
            // éš¨æ©Ÿç²å¾—å‹•ç‰©åœ–é‘‘
            grantRandomAnimals(count) {
                const uncollected = window.animals.filter(a => !a.collected);
                if (uncollected.length === 0) return [];
                
                const actualCount = Math.min(count, uncollected.length);
                const newAnimals = [];
                
                for (let i = 0; i < actualCount; i++) {
                    const randomIndex = Math.floor(Math.random() * uncollected.length);
                    const animal = uncollected.splice(randomIndex, 1)[0];
                    animal.collected = true;
                    newAnimals.push(animal);
                }
                
                this.saveCollectedAnimals();
                return newAnimals;
            }
            
            // é¡¯ç¤ºç²å¾—å‹•ç‰©çš„æˆå°±å½ˆçª—
            showAnimalReward(newAnimals) {
                if (newAnimals.length === 0) return;
                
                const popup = document.createElement('div');
                popup.className = 'animal-reward-popup';
                popup.innerHTML = `
                    <div class="reward-content">
                        <div class="reward-header">
                            <h2>ğŸ‰ ç²å¾—æ–°å‹•ç‰©åœ–é‘‘ï¼</h2>
                            <p>æ­å–œå®Œæˆé—œå¡ï¼Œç²å¾— ${newAnimals.length} å¼µå‹•ç‰©åœ–é‘‘</p>
                        </div>
                        <div class="reward-animals">
                            ${newAnimals.map(animal => `
                                <div class="reward-animal">
                                    <div class="animal-emoji">${animal.emoji}</div>
                                    <div class="animal-name">${animal.name}</div>
                                    <div class="animal-category">${getCategoryName(animal.category)}</div>
                                </div>
                            `).join('')}
                        </div>
                        <button class="reward-close-btn" onclick="this.parentElement.parentElement.remove()">ç¢ºå®š</button>
                    </div>
                `;
                
                document.body.appendChild(popup);
                setTimeout(() => popup.classList.add('show'), 100);
                
                // æ’­æ”¾çå‹µéŸ³æ•ˆ
                this.playRewardSound();
            }
            
            // æ’­æ”¾çå‹µéŸ³æ•ˆ
            playRewardSound() {
                try {
                    const audio = new Audio('../audio/achievement.mp3');
                    audio.volume = 0.5;
                    audio.play().catch(() => {});
                } catch (e) {}
            }
        }
        
        // å…¨åŸŸå‹•ç‰©æ”¶é›†ç³»çµ±å¯¦ä¾‹
        window.animalCollection = new AnimalCollectionSystem();
        
        // åˆå§‹åŒ–é é¢
        function init() {
            console.log('åˆå§‹åŒ–å‹•ç‰©åœ–é‘‘é é¢');
            console.log('ç¸½å‹•ç‰©æ•¸é‡:', animals.length);
            console.log('å·²æ”¶é›†å‹•ç‰©:', animals.filter(a => a.collected).length);
            renderCards();
            updateProgress();
            bindEvents();
        }

        // æ¸²æŸ“å¡ç‰‡
        function renderCards() {
            const grid = document.getElementById('cardsGrid');
            if (!grid) return;
            
            const filteredAnimals = window.animals.filter(animal => {
                const matchCategory = currentFilter === 'all' || animal.category === currentFilter;
                const matchSearch = currentSearch === '' || animal.name.toLowerCase().includes(currentSearch.toLowerCase());
                return matchCategory && matchSearch;
            });

            grid.innerHTML = filteredAnimals.map(animal => `
                <div class="animal-card ${animal.collected ? 'collected' : 'uncollected'}" onclick="openModal(${animal.id})">
                    ${animal.collected ? '<div class="collected-badge">âœ“</div>' : ''}
                    <div class="card-image">
                        ${animal.collected ? animal.emoji : 'â“'}
                    </div>
                    <div class="card-name">${animal.collected ? animal.name : 'ç¥ç§˜å‹•ç‰©'}</div>
                    <div class="card-category">${getCategoryName(animal.category)}</div>
                </div>
            `).join('');
        }

        // ç²å–åˆ†é¡ä¸­æ–‡åç¨±
        function getCategoryName(category) {
            const names = {
                forest: 'æ£®æ—',
                ocean: 'æµ·æ´‹',
                farm: 'è¾²å ´',
                savanna: 'è‰åŸ'
            };
            return names[category] || 'æœªçŸ¥';
        }

        // æ›´æ–°é€²åº¦
        function updateProgress() {
            const collected = window.animals.filter(animal => animal.collected).length;
            const total = window.animals.length;
            const percentage = Math.round((collected / total) * 100);
            
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            if (progressFill) progressFill.style.width = percentage + '%';
            if (progressText) progressText.textContent = `å·²æ”¶é›†: ${collected}/${total} (${percentage}%)`;
        }

        // ç¶å®šäº‹ä»¶
        function bindEvents() {
            // åˆ†é¡æ¨™ç±¤äº‹ä»¶
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                    button.classList.add('active');
                    currentFilter = button.getAttribute('data-category');
                    renderCards();
                });
            });

            // æœå°‹äº‹ä»¶
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    currentSearch = e.target.value;
                    renderCards();
                });
            }
        }

        // é–‹å•Ÿå‹•ç‰©è©³ç´°è³‡è¨Šå½ˆçª—
        function openModal(animalId) {
            const animal = window.animals.find(a => a.id === animalId);
            if (!animal || !animal.collected) return;

            document.getElementById('modalImage').textContent = animal.emoji;
            document.getElementById('modalName').textContent = animal.name;
            document.getElementById('animalInfo').innerHTML = `
                <h4>ğŸ  æ£²æ¯åœ°ï¼š${animal.habitat}</h4>
                <p><strong>ğŸ¯ æœ‰è¶£å°çŸ¥è­˜ï¼š</strong></p>
                <p>${animal.fact}</p>
            `;
            
            document.getElementById('animalModal').classList.add('show');
        }

        // é—œé–‰å½ˆçª—
        function closeModal() {
            document.getElementById('animalModal').classList.remove('show');
        }

        // æ’­æ”¾å‹•ç‰©å«è²
        function playAnimalSound() {
            // é€™è£¡å¯ä»¥æ¥å…¥å¯¦éš›çš„éŸ³æ•ˆæ’­æ”¾åŠŸèƒ½
            alert('ğŸ”Š ' + getCurrentAnimal().sound);
        }

        // ç²å–ç•¶å‰é¡¯ç¤ºçš„å‹•ç‰©
        function getCurrentAnimal() {
            const modalName = document.getElementById('modalName').textContent;
            return window.animals.find(animal => animal.name === modalName);
        }

        // é—œå¡å®Œæˆå¾Œç²å¾—å‹•ç‰©çå‹µï¼ˆä¾›éŠæˆ²èª¿ç”¨ï¼‰
        function grantGameReward(gameId) {
            const rewardCount = Math.floor(Math.random() * 3) + 2; // éš¨æ©Ÿ2-4éš»å‹•ç‰©
            const newAnimals = window.animalCollection.grantRandomAnimals(rewardCount);
            
            if (newAnimals.length > 0) {
                setTimeout(() => {
                    window.animalCollection.showAnimalReward(newAnimals);
                    renderCards();
                    updateProgress();
                }, 1000);
            }
        }
        
        // æ”¶é›†æ–°å‹•ç‰©ï¼ˆä¾›éŠæˆ²å…¶ä»–éƒ¨åˆ†èª¿ç”¨ï¼‰
        function collectAnimal(animalId) {
            const animal = window.animals.find(a => a.id === animalId);
            if (animal && !animal.collected) {
                animal.collected = true;
                window.animalCollection.saveCollectedAnimals();
                renderCards();
                updateProgress();
                showAchievement(`ğŸ‰ æ­å–œæ”¶é›†åˆ°æ–°å‹•ç‰©ï¼š${animal.name}ï¼`);
            }
        }

        // é¡¯ç¤ºæˆå°±æç¤º
        function showAchievement(text) {
            const popup = document.getElementById('achievementPopup');
            const achievementText = document.getElementById('achievementText');
            
            if (popup && achievementText) {
                achievementText.textContent = text;
                popup.classList.add('show');
                
                setTimeout(() => {
                    popup.classList.remove('show');
                }, 3000);
            }
        }

        // é»æ“Šå½ˆçª—å¤–éƒ¨é—œé–‰
        const animalModal = document.getElementById('animalModal');
        if (animalModal) {
            animalModal.addEventListener('click', (e) => {
                if (e.target.id === 'animalModal') {
                    closeModal();
                }
            });
        }


        
        // é é¢è¼‰å…¥å®Œæˆå¾Œåˆå§‹åŒ–ï¼ˆåªåœ¨å‹•ç‰©åœ–é‘‘é é¢ï¼‰
        document.addEventListener('DOMContentLoaded', function() {
            // æª¢æŸ¥æ˜¯å¦ç‚ºå‹•ç‰©åœ–é‘‘é é¢
            if (document.getElementById('cardsGrid')) {
                init();
            }
        });