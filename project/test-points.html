<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>點數系統測試</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
    button { margin: 5px; padding: 10px; }
    .display { font-size: 18px; font-weight: bold; margin: 10px 0; }
  </style>
</head>
<body>
  <h1>點數管理系統測試</h1>
  
  <div class="test-section">
    <h3>當前狀態</h3>
    <div class="display">研究點數: <span id="research-points">0</span></div>
    <div class="display">金幣: <span id="coins">0</span></div>
    <div class="display player-info">研究點數: 0</div>
  </div>
  
  <div class="test-section">
    <h3>研究點數操作</h3>
    <button onclick="pointsManager.addPoints(10)">+10 點數</button>
    <button onclick="pointsManager.addPoints(50)">+50 點數</button>
    <button onclick="pointsManager.subtractPoints(20)">-20 點數</button>
    <button onclick="pointsManager.setPoints(100)">設為 100</button>
  </div>
  
  <div class="test-section">
    <h3>金幣操作</h3>
    <button onclick="pointsManager.addCoins(25)">+25 金幣</button>
    <button onclick="pointsManager.addCoins(100)">+100 金幣</button>
    <button onclick="pointsManager.subtractCoins(50)">-50 金幣</button>
    <button onclick="pointsManager.setCoins(200)">設為 200</button>
  </div>
  
  <div class="test-section">
    <h3>系統操作</h3>
    <button onclick="pointsManager.reset()">重置所有</button>
    <button onclick="pointsManager.updateDisplay()">更新顯示</button>
    <button onclick="testStorage()">測試存儲</button>
  </div>
  
  <div class="test-section">
    <h3>測試結果</h3>
    <div id="test-results"></div>
  </div>

  <script src="js/points-manager.js"></script>
  <script>
    // 添加監聽器來實時更新顯示
    pointsManager.addListener((type, value) => {
      console.log(`${type} 更新為: ${value}`);
      document.getElementById('test-results').innerHTML += 
        `<p>${new Date().toLocaleTimeString()}: ${type} 更新為 ${value}</p>`;
    });
    
    // 測試存儲功能
    function testStorage() {
      const points = pointsManager.getPoints();
      const coins = pointsManager.getCoins();
      
      // 重新載入頁面後檢查數據是否保持
      localStorage.setItem('test_points', points);
      localStorage.setItem('test_coins', coins);
      
      setTimeout(() => {
        const savedPoints = localStorage.getItem('test_points');
        const savedCoins = localStorage.getItem('test_coins');
        const currentPoints = pointsManager.getPoints();
        const currentCoins = pointsManager.getCoins();
        
        const result = (savedPoints == currentPoints && savedCoins == currentCoins) 
          ? '✅ 存儲測試通過' : '❌ 存儲測試失敗';
        
        document.getElementById('test-results').innerHTML += `<p>${result}</p>`;
      }, 100);
    }
    
    // 初始化顯示
    pointsManager.updateDisplay();
  </script>
</body>
</html>